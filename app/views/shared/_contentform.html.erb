<%= form_with(model: content) do |form| %>
  <div class="single-input">
    <%= form.label :title %>
    <%= form.text_field :title, class: "longer-input" %>
  </div>

  <div class="single-input">
    <% if type == 'post'%>
      <%= form.label :body, style: "display: block" %>
      <%= form.text_area :body, minlength: 10, maxlength: 2000, class: "longer-input"  %>
    <% else %>
      <%= form.label :body, "Caption", style: "display: block" %>
      <%= form.text_field :body, maxlength: 200, class: "longer-input"  %>
    <% end %>
  </div>

  <% if type == 'image'%>
    <div class="attachments" data-controller="contents">
      <div class="single-input">
        <%= form.label :attached_images, style: "display: block" %>
        <% if mode != 'Edit' # Cannot alter attached images via editing %>
          <%= form.file_field :attached_images, multiple: true, accept: "image/*", data: { maxFiles: 10, contents_target: "fileupload" } %>
        <% end %>
      </div>
      <div class="preview-images" data-contents-target="imgpreview">
        <% if content.attached_images.attached? %>
          <% content.attached_images.each do |attached_image| %>
            <%= image_tag attached_image.variant(:thumb) %>
          <% end %>
        <% end %>
      </div>
    </div>
  <% elsif type == 'video' %>
    <div class="attachments single-input">
      <% if content.attached_video.attached? %>
        <div class="video-container" data-controller="contents">
          <% metadata = content.attached_video.blob.metadata %>
          <% aspect_ratio = metadata[:width].to_f / metadata[:height].to_f %>
          <%= video_tag rails_blob_path(content.attached_video, only_path: true), controls: true, data: {contents_target: "video", aspect_ratio: aspect_ratio } %>
        </div>
      <% else %>
        <%= form.label :attached_video, style: "display: block" %>
        <%= form.file_field :attached_video, accept: "video/*" %>
      <% end %>
    </div>
  <% end %>

  <div class="dog-list" data-controller="dogselector">
    <div class="sub-title">Select dogs</div>
    <div class="list">
    <% current_user.dogs.each do |dog| %>
      <div class="dog-checkbox">
        <%= check_box_tag 'content[dog_ids][]', dog.id, content.dogs.include?(dog), { class: 'dog-select-checkbox', id: "dog_ids_#{dog.id}" } %>
        <% label_class = content.dogs.include?(dog) ? "dog-select-label clicked" : "dog-select-label"%>
        <%= label_tag "dog_ids_#{dog.id}", image_tag(dog.avatar.variant(:thumb), class: "dog-select"), class: label_class, data: { action: "click->dogselector#select" } %>
      </div>
    <% end %>
    </div>
  </div>

  <div class="wide-button">
    <%= form.hidden_field 'dog_ids][]', value: '' %>
    <%= form.hidden_field :content_type, value: @content.content_type %>
    <%= form.submit "#{mode}", class: "#{mode.downcase}" %>
  </div>

  <%= render 'shared/errors', object: content %>
<% end %>